# [01] TapiocaOptionLiquidityProvision.sol doesn't fully support ERC1155
According to [comments on L356](https://github.com/Tapioca-DAO/tap-token-audit/blob/59749be5bc2286f0bdbf59d7ddc258ddafd49a9f/contracts/options/TapiocaOptionLiquidityProvision.sol#L356C17-L371), the contract is supposed to support ERC1155.
Quoting from [eip-1155](https://eips.ethereum.org/EIPS/eip-1155): **Smart contracts MUST implement all of the functions in the ERC1155TokenReceiver interface to accept transfers.**
To fully support ERC1155, the contract should also implement `function onERC1155BatchReceived`

# [02] BaseTapOFT._lockTwTapPosition should revoke allowance when `twTap.participate` fails
Function [BaseTapOFT._lockTwTapPosition](https://github.com/Tapioca-DAO/tap-token-audit/blob/59749be5bc2286f0bdbf59d7ddc258ddafd49a9f/contracts/tokens/BaseTapOFT.sol#L125C14-L149) first approves `twTap` to spend `amount` of token, then the function calls [twTap.participate](https://github.com/Tapioca-DAO/tap-token-audit/blob/59749be5bc2286f0bdbf59d7ddc258ddafd49a9f/contracts/tokens/BaseTapOFT.sol#L138C13-L140). If `twTap.participate` fails, the function will first emit a event, then transfers the tokens. 
**But the function forgets to revoke the allowance approved to twTap** in [Line135](https://github.com/Tapioca-DAO/tap-token-audit/blob/59749be5bc2286f0bdbf59d7ddc258ddafd49a9f/contracts/tokens/BaseTapOFT.sol#L135C25-L135C30)

# [03] missing updating `_yieldBoxShares` in function SGLLendingCommon._borrow
While calling [SGLLendingCommon._addCollateral](https://github.com/Tapioca-DAO/tapioca-bar-audit/blob/2286f80f928f41c8bc189d0657d74ba83286c668/contracts/markets/singularity/SGLLendingCommon.sol#L16-L37) and [SGLLendingCommon._repay](https://github.com/Tapioca-DAO/tapioca-bar-audit/blob/2286f80f928f41c8bc189d0657d74ba83286c668/contracts/markets/singularity/SGLLendingCommon.sol#L83-L97), `_yieldBoxShares` is updated in [function _addTokens](https://github.com/Tapioca-DAO/tapioca-bar-audit/blob/2286f80f928f41c8bc189d0657d74ba83286c668/contracts/markets/singularity/SGLCommon.sol#L174C19-L194), and in [SGLLendingCommon._removeCollateral](https://github.com/Tapioca-DAO/tapioca-bar-audit/blob/2286f80f928f41c8bc189d0657d74ba83286c668/contracts/markets/singularity/SGLLendingCommon.sol#L41-L55), `_yieldBoxShares` is also got updated. 
It seems that only `SGLLendingCommon._borrow` doesn't update `_yieldBoxShares`. So I'm guessing it's better to update it too

# [04] totalBorrow.sub in SGLLendingCommon._repay should roundDown instead roundUp
While handling roundDown/roundUp issue in borrow/repay system, I think it's better to make the tiny profit toward to the protocol to make the system more robust.
With above idea in mind, I think it's better to change `true` to `false` in [totalBorrow.sub](https://github.com/Tapioca-DAO/tapioca-bar-audit/blob/2286f80f928f41c8bc189d0657d74ba83286c668/contracts/markets/singularity/SGLLendingCommon.sol#L89C33-L89C48) in [SGLLendingCommon._repay](https://github.com/Tapioca-DAO/tapioca-bar-audit/blob/2286f80f928f41c8bc189d0657d74ba83286c668/contracts/markets/singularity/SGLLendingCommon.sol#L83C14-L98)
Which also comply with [totalBorrow.add](https://github.com/Tapioca-DAO/tapioca-bar-audit/blob/2286f80f928f41c8bc189d0657d74ba83286c668/contracts/markets/singularity/SGLLendingCommon.sol#L65C31-L65C46) in [SGLLendingCommon._borrow](https://github.com/Tapioca-DAO/tapioca-bar-audit/blob/2286f80f928f41c8bc189d0657d74ba83286c668/contracts/markets/singularity/SGLLendingCommon.sol#L58C14-L80)